---
id: mem-20260119-a1b2c3
question: "How does the project implement associative arrays to ensure compatibility with Bash 3.2 on macOS?"
created: 2026-01-19
last_retrieved: ""
sprints:
  - "1.0_anthropic_protocol_support"
files: []
tags:
  - bash
  - compatibility
  - macos
  - associative-arrays
  - cross-platform
retrievals: 0
status: active
---

# Bash 3.2 Associative Array Emulation

## Decision

The project implements a compatibility layer for associative arrays using wrapper functions `compat_assoc_set()` and `compat_assoc_get()`. Since Bash 3.2 (the default shell on macOS) does not natively support associative arrays, these functions emulate this behavior using dynamic variable naming constructed via `eval`. This approach includes strict escaping mechanisms to handle special characters safely, ensuring consistent behavior across both Bash 3.2 environments and Bash 4+ (Linux) systems.

## Rationale

- **macOS Default Shell**: macOS continues to ship with Bash 3.2 due to GPLv3 licensing restrictions on newer Bash versions.
- **Seamless User Experience**: Emulation avoids the requirement for macOS users to manually upgrade their shell (e.g., via Homebrew) to run the `llm-env` tools.
- **Portability**: Provides a unified method for handling key-value data without maintaining separate logic branches for different operating systems.

## Applies When

- Developing shell scripts intended to run on standard macOS installations without dependencies.
- Storing configuration or state in key-value pairs within shell scripts.
- Debugging issues related to variable expansion or array access on macOS.

## Code Reference

Look for `compat_assoc_set` and `compat_assoc_get` usage. The pattern typically involves:
`eval "key_${safe_key}='${value}'"` (conceptual) within the wrapper functions to simulate `array[key]=value`.
